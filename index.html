<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle de Horas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 24px;
            margin-bottom: 24px;
        }

        .loading-section {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .config-section {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            margin-bottom: 16px;
        }

        .label {
            display: block;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }

        .input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            width: 100%;
        }

        .btn:hover {
            background: #2563eb;
        }

        .btn-secondary {
            background: #6b7280;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .status-log {
            background: #1f2937;
            color: #e5e7eb;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }

        .error-section {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 20px;
            color: #991b1b;
        }

        .success-section {
            background: #dcfce7;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 20px;
            color: #166534;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Loading inicial -->
        <div id="loadingSection" class="card">
            <div class="loading-section">
                <div class="spinner"></div>
                <h2>üî• Carregando Firebase...</h2>
                <p>Tentando m√∫ltiplas fontes para garantir compatibilidade</p>
                <div id="loadingLog" class="status-log">
                    Iniciando carregamento...<br>
                </div>
            </div>
        </div>

        <!-- Configura√ß√£o Firebase -->
        <div id="configSection" class="config-section hidden">
            <h2 style="color: #92400e; margin-bottom: 16px;">üîß Configure o Firebase</h2>
            <p style="margin-bottom: 16px;">Firebase carregado com sucesso! Agora configure suas credenciais:</p>
            
            <div class="form-grid">
                <div>
                    <div class="form-group">
                        <label class="label">API Key</label>
                        <input type="text" id="apiKey" class="input" placeholder="AIzaSy...">
                    </div>
                    <div class="form-group">
                        <label class="label">Auth Domain</label>
                        <input type="text" id="authDomain" class="input" placeholder="projeto.firebaseapp.com">
                    </div>
                    <div class="form-group">
                        <label class="label">Project ID</label>
                        <input type="text" id="projectId" class="input" placeholder="projeto-id">
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label class="label">Storage Bucket</label>
                        <input type="text" id="storageBucket" class="input" placeholder="projeto.appspot.com">
                    </div>
                    <div class="form-group">
                        <label class="label">Messaging Sender ID</label>
                        <input type="text" id="messagingSenderId" class="input" placeholder="123456789">
                    </div>
                    <div class="form-group">
                        <label class="label">App ID</label>
                        <input type="text" id="appId" class="input" placeholder="1:123:web:abc123">
                    </div>
                </div>
            </div>
            
            <button onclick="initializeFirebase()" class="btn">
                üî• Conectar com Firebase
            </button>
        </div>

        <!-- Erro -->
        <div id="errorSection" class="error-section hidden">
            <h2>‚ùå N√£o foi poss√≠vel carregar o Firebase</h2>
            <p><strong>Poss√≠veis causas:</strong></p>
            <ul style="margin: 10px 0 10px 20px;">
                <li>Firewall corporativo bloqueando</li>
                <li>Antiv√≠rus com prote√ß√£o web ativa</li>
                <li>Rede restrita (escola/empresa)</li>
                <li>DNS bloqueando googleapis.com</li>
            </ul>
            <p><strong>Solu√ß√µes:</strong></p>
            <ol style="margin: 10px 0 10px 20px;">
                <li>Tente de outra rede (4G do celular)</li>
                <li>Desative antiv√≠rus temporariamente</li>
                <li>Use VPN</li>
                <li>Pe√ßa ao TI para liberar *.googleapis.com</li>
            </ol>
            
            <button onclick="retryFirebase()" class="btn">
                üîÑ Tentar Novamente
            </button>
            
            <button onclick="useModeLocal()" class="btn btn-secondary">
                üíª Usar Modo Local (Funciona sempre)
            </button>
        </div>

        <!-- Sistema principal -->
        <div id="mainSystem" class="hidden">
            <div class="success-section">
                <h2>‚úÖ Firebase Conectado com Sucesso!</h2>
                <p>Sistema online funcionando. Todos os dados ser√£o sincronizados na nuvem.</p>
            </div>
            <!-- Aqui viria o sistema completo -->
        </div>
    </div>

    <script>
        let loadAttempts = 0;
        const maxAttempts = 3;
        
        // Lista de CDNs alternativos
        const firebaseSources = [
            // Google CDN oficial
            {
                name: "Google CDN (Oficial)",
                app: "https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js",
                firestore: "https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"
            },
            // jsDelivr CDN
            {
                name: "jsDelivr CDN",
                app: "https://cdn.jsdelivr.net/npm/firebase@8.10.1/firebase-app.js",
                firestore: "https://cdn.jsdelivr.net/npm/firebase@8.10.1/firebase-firestore.js"
            },
            // unpkg CDN
            {
                name: "unpkg CDN",
                app: "https://unpkg.com/firebase@8.10.1/firebase-app.js",
                firestore: "https://unpkg.com/firebase@8.10.1/firebase-firestore.js"
            }
        ];

        function log(message) {
            const logElement = document.getElementById('loadingLog');
            if (logElement) {
                logElement.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
                logElement.scrollTop = logElement.scrollHeight;
            }
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        async function tryLoadFirebase(sourceIndex = 0) {
            if (sourceIndex >= firebaseSources.length) {
                log('‚ùå Todas as fontes falharam');
                showError();
                return;
            }

            const source = firebaseSources[sourceIndex];
            log(`üîÑ Tentando: ${source.name}`);

            try {
                // Tentar carregar Firebase App
                await loadScript(source.app);
                log(`‚úÖ App carregado de: ${source.name}`);
                
                // Tentar carregar Firestore
                await loadScript(source.firestore);
                log(`‚úÖ Firestore carregado de: ${source.name}`);
                
                // Verificar se Firebase est√° dispon√≠vel
                if (typeof firebase !== 'undefined') {
                    log('üéâ Firebase carregado com sucesso!');
                    showConfig();
                    return;
                }
                
                throw new Error('Firebase object not available');
                
            } catch (error) {
                log(`‚ùå Falhou: ${source.name} - ${error.message}`);
                // Tentar pr√≥xima fonte
                setTimeout(() => tryLoadFirebase(sourceIndex + 1), 1000);
            }
        }

        function showConfig() {
            document.getElementById('loadingSection').classList.add('hidden');
            document.getElementById('configSection').classList.remove('hidden');
            
            // Verificar se h√° config salva
            const saved = localStorage.getItem('firebaseConfig');
            if (saved) {
                try {
                    const config = JSON.parse(saved);
                    Object.keys(config).forEach(key => {
                        const input = document.getElementById(key);
                        if (input) input.value = config[key];
                    });
                } catch (e) {
                    console.error('Erro ao carregar config salva:', e);
                }
            }
        }

        function showError() {
            document.getElementById('loadingSection').classList.add('hidden');
            document.getElementById('errorSection').classList.remove('hidden');
        }

        function retryFirebase() {
            document.getElementById('errorSection').classList.add('hidden');
            document.getElementById('loadingSection').classList.remove('hidden');
            document.getElementById('loadingLog').innerHTML = 'Tentando novamente...<br>';
            
            // Limpar scripts anteriores
            const scripts = document.querySelectorAll('script[src*="firebase"]');
            scripts.forEach(script => script.remove());
            
            // Reiniciar tentativas
            setTimeout(() => tryLoadFirebase(0), 500);
        }

        function useModeLocal() {
            // Redirecionar para vers√£o local
            alert('Redirecionando para modo local...');
            window.location.href = window.location.href.replace(/[^\/]*$/, '') + 'local.html';
        }

        function initializeFirebase() {
            const config = {
                apiKey: document.getElementById('apiKey').value.trim(),
                authDomain: document.getElementById('authDomain').value.trim(),
                projectId: document.getElementById('projectId').value.trim(),
                storageBucket: document.getElementById('storageBucket').value.trim(),
                messagingSenderId: document.getElementById('messagingSenderId').value.trim(),
                appId: document.getElementById('appId').value.trim()
            };

            if (!config.apiKey || !config.projectId) {
                alert('‚ùå Por favor, preencha pelo menos API Key e Project ID');
                return;
            }

            try {
                // Verificar se j√° foi inicializado
                if (firebase.apps.length === 0) {
                    firebase.initializeApp(config);
                }
                
                const db = firebase.firestore();
                
                // Testar conex√£o
                db.collection('test').limit(1).get()
                    .then(() => {
                        localStorage.setItem('firebaseConfig', JSON.stringify(config));
                        
                        document.getElementById('configSection').classList.add('hidden');
                        document.getElementById('mainSystem').classList.remove('hidden');
                        
                        // Aqui voc√™ redirecionaria para o sistema principal ou incluiria o c√≥digo completo
                        alert('üéâ Firebase conectado! Agora voc√™ precisa incluir o sistema principal aqui.');
                        
                    })
                    .catch((error) => {
                        alert('‚ùå Erro na configura√ß√£o: Verifique as credenciais\n\n' + error.message);
                    });
                
            } catch (error) {
                alert('‚ùå Erro ao inicializar Firebase:\n\n' + error.message);
            }
        }

        // Iniciar carregamento quando p√°gina carregar
        window.addEventListener('load', () => {
            setTimeout(() => tryLoadFirebase(0), 500);
        });
    </script>
</body>
</html>
